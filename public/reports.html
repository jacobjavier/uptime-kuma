<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes - iCentral</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .stats-card {
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
            margin-bottom: 20px;
        }
        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        .stats-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
            color: white;
        }
        .navbar-brand img {
            width: 40px;
            height: 40px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="/dashboard">
                <img src="/logo.png" alt="iCentral" class="me-2">
                <span class="fs-4">iCentral</span>
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/dashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a class="nav-link active" href="/reports.html">
                    <i class="fas fa-chart-line"></i> Reportes
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <h1 class="mb-4">
            <i class="fas fa-chart-line"></i> Centro de Reportes - iCentral
        </h1>

        <!-- Estadísticas Rápidas -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stats-card bg-success text-white">
                    <div class="card-body text-center">
                        <div class="stats-icon bg-success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h4 id="monitorsUp">6</h4>
                        <p>Monitores Funcionando</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card bg-danger text-white">
                    <div class="card-body text-center">
                        <div class="stats-icon bg-danger">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <h4 id="monitorsDown">0</h4>
                        <p>Monitores Caídos</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card bg-info text-white">
                    <div class="card-body text-center">
                        <div class="stats-icon bg-info">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <h4 id="overallUptime">95.8%</h4>
                        <p>Disponibilidad General</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card bg-warning text-white">
                    <div class="card-body text-center">
                        <div class="stats-icon bg-warning">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h4 id="avgResponse">156ms</h4>
                        <p>Tiempo Promedio</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs de Reportes -->
        <ul class="nav nav-tabs mb-4" id="reportTabs">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#downtime">
                    <i class="fas fa-exclamation-triangle"></i> Downtime
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#performance">
                    <i class="fas fa-tachometer-alt"></i> Rendimiento
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#export">
                    <i class="fas fa-download"></i> Exportar
                </a>
            </li>
        </ul>

        <div class="tab-content">
            <!-- Tab Downtime -->
            <div class="tab-pane fade show active" id="downtime">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Gráfica de Disponibilidad (7 días)</h5>
                                <canvas id="uptimeChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Estado de Monitores</h5>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Monitor</th>
                                                <th>Estado</th>
                                                <th>Uptime</th>
                                            </tr>
                                        </thead>
                                        <tbody id="monitorsTable">
                                            <tr>
                                                <td>BGP iCentral</td>
                                                <td><span class="badge bg-warning">94.74%</span></td>
                                                <td>Funcionando</td>
                                            </tr>
                                            <tr>
                                                <td>BGP4 Sparkle Local</td>
                                                <td><span class="badge bg-success">100%</span></td>
                                                <td>Funcionando</td>
                                            </tr>
                                            <tr>
                                                <td>BGPv4 Sparkle Gw</td>
                                                <td><span class="badge bg-success">100%</span></td>
                                                <td>Funcionando</td>
                                            </tr>
                                            <tr>
                                                <td>BGPv4 Zayo Gw</td>
                                                <td><span class="badge bg-success">100%</span></td>
                                                <td>Funcionando</td>
                                            </tr>
                                            <tr>
                                                <td>BGPv6 Zayo Local</td>
                                                <td><span class="badge bg-danger">0%</span></td>
                                                <td>Caído</td>
                                            </tr>
                                            <tr>
                                                <td>BGPv6 Sparkle Local</td>
                                                <td><span class="badge bg-danger">0%</span></td>
                                                <td>Caído</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Rendimiento -->
            <div class="tab-pane fade" id="performance">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body text-center">
                                <h6 class="text-muted">Tiempo Promedio</h6>
                                <h3 class="text-primary">156ms</h3>
                                <small class="text-success"><i class="fas fa-arrow-down"></i> 12% mejor</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body text-center">
                                <h6 class="text-muted">Tiempo P95</h6>
                                <h3 class="text-warning">520ms</h3>
                                <small class="text-warning"><i class="fas fa-arrow-up"></i> 5% peor</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body text-center">
                                <h6 class="text-muted">Tiempo Máximo</h6>
                                <h3 class="text-danger">1250ms</h3>
                                <small class="text-danger"><i class="fas fa-arrow-up"></i> 20% peor</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card mt-4">
                    <div class="card-body">
                        <h5 class="card-title">Tendencia de Rendimiento</h5>
                        <canvas id="performanceChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Tab Exportar -->
            <div class="tab-pane fade" id="export">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="fas fa-download"></i> Exportar Reportes
                                </h5>
                                <p>Descarga datos de monitoreo en diferentes formatos para análisis.</p>
                                <div class="d-grid gap-2">
                                    <button onclick="exportJSON()" class="btn btn-primary">
                                        <i class="fas fa-file-code"></i> Exportar JSON
                                    </button>
                                    <button onclick="exportCSV()" class="btn btn-success">
                                        <i class="fas fa-file-csv"></i> Exportar CSV
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="fas fa-info-circle"></i> Información
                                </h5>
                                <ul class="list-unstyled">
                                    <li><strong>Última actualización:</strong> <span id="lastUpdate"></span></li>
                                    <li><strong>Total monitores:</strong> 6</li>
                                    <li><strong>Período de datos:</strong> Últimos 30 días</li>
                                    <li><strong>Formato de fecha:</strong> ISO 8601</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Actualizar timestamp
        document.getElementById('lastUpdate').textContent = new Date().toLocaleString('es-ES');

        // Datos de ejemplo para las gráficas
        const uptimeData = {
            labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
            datasets: [{
                label: 'Disponibilidad (%)',
                data: [95.2, 96.1, 94.8, 95.5, 96.3, 95.9, 95.8],
                borderColor: '#5cdd8b',
                backgroundColor: 'rgba(92, 221, 139, 0.1)',
                fill: true,
                tension: 0.4
            }]
        };

        const performanceData = {
            labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
            datasets: [{
                label: 'Tiempo de Respuesta (ms)',
                data: [145, 156, 162, 148, 159, 151, 156],
                borderColor: '#0dcaf0',
                backgroundColor: 'rgba(13, 202, 240, 0.1)',
                fill: true,
                tension: 0.4
            }]
        };

        // Crear gráficas
        const uptimeCtx = document.getElementById('uptimeChart').getContext('2d');
        new Chart(uptimeCtx, {
            type: 'line',
            data: uptimeData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        min: 90,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    }
                }
            }
        });

        const performanceCtx = document.getElementById('performanceChart').getContext('2d');
        new Chart(performanceCtx, {
            type: 'line',
            data: performanceData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value + 'ms';
                            }
                        }
                    }
                }
            }
        });

        // Funciones de exportación
        function exportJSON() {
            const data = {
                timestamp: new Date().toISOString(),
                report_type: "icentral_monitoring_report",
                period: "last_30_days",
                summary: {
                    total_monitors: 6,
                    monitors_up: 4,
                    monitors_down: 2,
                    overall_availability: 95.8,
                    avg_response_time_ms: 156
                },
                monitors: [
                    {
                        name: "BGP iCentral",
                        status: "up",
                        uptime_percentage: 94.74,
                        avg_response_time_ms: 156,
                        last_incident: "2025-09-26T11:44:08Z"
                    },
                    {
                        name: "BGP4 Sparkle Local", 
                        status: "up",
                        uptime_percentage: 100,
                        avg_response_time_ms: 89,
                        last_incident: null
                    },
                    {
                        name: "BGPv4 Sparkle Gw",
                        status: "up", 
                        uptime_percentage: 100,
                        avg_response_time_ms: 112,
                        last_incident: null
                    },
                    {
                        name: "BGPv4 Zayo Gw",
                        status: "up",
                        uptime_percentage: 100,
                        avg_response_time_ms: 134,
                        last_incident: null
                    },
                    {
                        name: "BGPv6 Zayo Local",
                        status: "down",
                        uptime_percentage: 0,
                        avg_response_time_ms: 0,
                        last_incident: "2025-09-26T11:44:08Z",
                        error: "Network unreachable"
                    },
                    {
                        name: "BGPv6 Sparkle Local",
                        status: "down",
                        uptime_percentage: 0,
                        avg_response_time_ms: 0,
                        last_incident: "2025-09-26T11:42:57Z",
                        error: "Network unreachable"
                    }
                ]
            };
            
            downloadFile(JSON.stringify(data, null, 2), 'icentral-report.json', 'application/json');
        }

        function exportCSV() {
            let csv = "Monitor,Estado,Disponibilidad,Tiempo_Promedio,Ultimo_Incidente,Error\n";
            const monitors = [
                ["BGP iCentral", "Funcionando", "94.74%", "156ms", "2025-09-26 11:44:08", ""],
                ["BGP4 Sparkle Local", "Funcionando", "100%", "89ms", "", ""],
                ["BGPv4 Sparkle Gw", "Funcionando", "100%", "112ms", "", ""],
                ["BGPv4 Zayo Gw", "Funcionando", "100%", "134ms", "", ""],
                ["BGPv6 Zayo Local", "Caído", "0%", "0ms", "2025-09-26 11:44:08", "Network unreachable"],
                ["BGPv6 Sparkle Local", "Caído", "0%", "0ms", "2025-09-26 11:42:57", "Network unreachable"]
            ];
            
            monitors.forEach(monitor => {
                csv += `"${monitor[0]}","${monitor[1]}","${monitor[2]}","${monitor[3]}","${monitor[4]}","${monitor[5]}"\n`;
            });
            
            downloadFile(csv, 'icentral-report.csv', 'text/csv');
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type: type });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
